
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ASP.NET MVC Exception Handling Part 3: Custom Model for Error View - Object Craftworks</title>
  <meta name="author" content="ObjectCraftworks.com">

  
  <meta name="description" content="In Part1 of this article, we covered default exception handling of the ASP.NET/MVC framework.
Part2 covered how to keep the view data set by the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://objectcraftworks.github.io/blog/2013/07/23/custom-model-for-errorview/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Object Craftworks" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Object Craftworks</a></h1>
  
    <h2><sup>{ Software by Craftspeople }</sup></h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:objectcraftworks.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ASP.NET MVC Exception Handling Part 3: Custom Model for Error View</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-23T16:07:00-04:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In <a href="/blog/2013/07/18/asp-dot-net-exception-handling-explained">Part1</a> of this article, we covered default exception handling of the ASP.NET/MVC framework.
<a href="/blog/2013/07/18/asp-dot-net-mvc4-global-error-handling/">Part2</a> covered how to keep the view data set by the controller for error view and master/layout.
 In this part, we will cover how to use a custom model.</p>

<p>   With default exception handling mechanism of the framework, you are stuck with the model framework supplies. When an exception is caught by the framework, It creates an object of the type <code>HandleErrorInfo</code>
and passes to the Error View.
 The framework doesn&rsquo;t provide any provision to extend this model or use different model altogether.</p>

<p>We will see how to provide an hook to extend the model.</p>

<p> <!-- more -->
Let&rsquo;s do this with our example of displaying customer contact information based on the context. This context could vary on things such customer location, type of error, or customer serving system, tech support etc.
Let&rsquo;s define a model for this.</p>

<figure class='code'><figcaption><span>CustomModel </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomModel</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">Exception</span> <span class="n">Exception</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">SupportInfo</span> <span class="n">SupportInfo</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">SupportInfo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">public</span> <span class="kt">string</span> <span class="n">ContactNo</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see how we would have done if it were happy path views.
We would</p>

<ol>
<li>create a model to encapsulate this information</li>
<li>load the model from data store or some other system based on the context</li>
<li>set this model in the Controller/Action</li>
<li>View uses this model to display the information.</li>
</ol>


<p>When we do above steps, the code would look as shown below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">SomeAction</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'> <span class="c1">//controller context</span>
</span><span class='line'> <span class="kt">var</span> <span class="n">supportInfo</span> <span class="p">=</span> <span class="n">GetSupportInfo</span><span class="p">(</span><span class="n">ControllerContext</span><span class="p">);</span><span class="c1">//a call to either your repo, or service</span>
</span><span class='line'> <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">supportInfo</span><span class="p">);</span><span class="c1">//which sets the model on the view</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
  That&rsquo;s a clean separation of concerns, of course the beauty of this code structure is coming from MVC pattern.</p>

<p>  We would expect same thing happening even for Error Views. But that&rsquo;s not the case. The framework handles error views differently. It sets the model and doesn&rsquo;t carry the ViewData set in Controller/Actions.</p>

<p>   We have only one option to implement this. We will have to put the logic of loading the model in the error page it self. That fixes the problem, but it&rsquo;s not clear separation of concerns.</p>

<p>   What we need to solve this problem correctly is a way to the framework use our model instead of default model HandlerErrorInfo.
 if we define model for our customer support information,
  <code>SupportInfo</code>,
   We need to LoadSupportInfo, and set that as a model, similar to what we would normally do for happy path views.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">//controller context</span>
</span><span class='line'><span class="kt">var</span> <span class="n">supportInfo</span> <span class="p">=</span> <span class="n">GetSupportInfo</span><span class="p">(</span><span class="n">ControllerContext</span><span class="p">);</span>
</span><span class='line'><span class="n">ViewResult</span><span class="p">.</span><span class="n">ViewData</span><span class="p">.</span><span class="n">Model</span> <span class="p">=</span> <span class="n">supportInfo</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>It turns out that we can this by extending HandleError filter.
   HandleError allows you specify error(default is Error.cshtml) or master/layout for your error view. Here is how you can specify different error, and layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">  [HandleError(Master=&quot;_ErrorLayout&quot;, View=&quot;ErrorWithCustomModel&quot;)]</span>
</span></code></pre></td></tr></table></div></figure>


<p> <br/>
  This is a good thing that HandleError allows custom views and layouts, but not custom model.</p>

<p> We can add something to this filter to allow us to specify a custom model.
The filter should call our code that loads the data and sets the model on view.
We are essentially providing a model to the framework. So we can add a new property to filter, we can call it ModelProvider.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">  [HandleErrorWithCustomModel(View=&quot;ErrorWithCustomModel&quot;, ModelProvider=typeof(ErrorModelProvider))]</span>
</span></code></pre></td></tr></table></div></figure>


<p>  Now we need define a contract for ModelProvider.
As Filter has two items it can pass to this model provider: ErrorContext, and the default model it creates. Let&rsquo;s define the signature</p>

<figure class='code'><figcaption><span>contract </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IErrorModelProvider</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">object</span> <span class="nf">GetModel</span><span class="p">(</span><span class="n">ExceptionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">HandleErrorInfo</span> <span class="n">defaultModel</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can implement it as shown below.</p>

<figure class='code'><figcaption><span>implementation </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ErrorModelProvider</span> <span class="p">:</span><span class="n">IErrorModelProvider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">object</span> <span class="nf">GetModel</span><span class="p">(</span><span class="n">ExceptionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">HandleErrorInfo</span> <span class="n">defaultModel</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="n">CustomModel</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>               <span class="n">Exception</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Exception</span><span class="p">,</span>
</span><span class='line'>               <span class="n">SupportInfo</span> <span class="p">=</span> <span class="n">GetSupportInfo</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span class='line'>           <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">SupportInfo</span> <span class="nf">GetSupportInfo</span><span class="p">(</span><span class="n">ExceptionContext</span> <span class="n">context</span><span class="p">){</span>
</span><span class='line'>     <span class="k">return</span> <span class="k">new</span> <span class="n">SupportInfo</span><span class="p">{</span>
</span><span class='line'>          <span class="n">ContactNo</span> <span class="p">=</span> <span class="s">&quot;1800SUPPORT&quot;</span><span class="p">;</span>
</span><span class='line'>       <span class="p">};</span><span class="c1">// or you can load it from external source</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> Now that we have custom model, let&rsquo;s extend the default filter to use this model.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">   [AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = true, Inherited = true)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">HandleErrorWithCustomModelAttribute</span> <span class="p">:</span> <span class="n">HandleErrorAttribute</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="n">Type</span> <span class="n">ModelProvider</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnException</span><span class="p">(</span><span class="n">ExceptionContext</span> <span class="n">filterContext</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">base</span><span class="p">.</span><span class="n">OnException</span><span class="p">(</span><span class="n">filterContext</span><span class="p">);</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">filterContext</span><span class="p">.</span><span class="n">Result</span> <span class="k">as</span> <span class="n">ViewResult</span><span class="p">;</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">modelProvider</span> <span class="p">=</span> <span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">(</span><span class="n">ModelProvider</span><span class="p">)</span> <span class="k">as</span> <span class="n">IErrorModelProvider</span><span class="p">;</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">model</span> <span class="p">=</span> <span class="n">modelProvider</span><span class="p">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">filterContext</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">Model</span> <span class="k">as</span> <span class="n">HandleErrorInfo</span><span class="p">);</span>
</span><span class='line'>            <span class="n">result</span><span class="p">.</span><span class="n">ViewData</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ViewDataDictionary</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">//If you need ViewData set by controller, You can add items of Controller.ViewData to View&#39;s ViewData.</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s add this filter to Home/Index as shown below.</p>

<figure class='code'><figcaption><span>HomeController.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">  [HandleErrorWithCustomModel(View=&quot;ErrorWithCustomModel&quot;, ModelProvider = typeof(ErrorModelProvider))]</span>
</span><span class='line'>
</span><span class='line'> <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">ViewBag</span><span class="p">.</span><span class="n">Temperature</span> <span class="p">=</span> <span class="s">&quot;67&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">();</span>
</span><span class='line'>            <span class="n">ViewBag</span><span class="p">.</span><span class="n">Message</span> <span class="p">=</span> <span class="s">&quot;Modify this template to jump-start your ASP.NET MVC application.&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>if you run the application now, you should see Custom Error View with custom model, displaying ContactNo correctly from model.</p>

<p><img src="/images/posts/aspdotnetmvc/error_custom_model.png"></p>

<p>  In this part, we have seen how to extend the default exception filter to use custom models.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Craftsman</span></span>

      








  


<time datetime="2013-07-23T16:07:00-04:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/asp-dot-net-slash-mvc4/'>ASP.NET/MVC4</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://objectcraftworks.github.io/blog/2013/07/23/custom-model-for-errorview/" data-via="" data-counturl="http://objectcraftworks.github.io/blog/2013/07/23/custom-model-for-errorview/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/07/18/asp-dot-net-mvc4-global-error-handling/" title="Previous Post: ASP.NET/MVC Exception Handling Part 2: Passing ViewData to Error View & its Master/Layout">&laquo; ASP.NET/MVC Exception Handling Part 2: Passing ViewData to Error View & its Master/Layout</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/07/24/asp-dot-net-mvc-viewdata-provider-for-error-view/" title="Next Post: ASP.NET/MVC Exception Handling Part 4: ViewDataProvider for Error View">ASP.NET/MVC Exception Handling Part 4: ViewDataProvider for Error View &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/24/asp-dot-net-mvc-viewdata-provider-for-error-view/">ASP.NET/MVC Exception Handling Part 4: ViewDataProvider for Error View</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/23/custom-model-for-errorview/">ASP.NET MVC Exception Handling Part 3: Custom Model for Error View</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/18/asp-dot-net-mvc4-global-error-handling/">ASP.NET/MVC Exception Handling Part 2: Passing ViewData to Error View & its Master/Layout</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/18/asp-dot-net-exception-handling-explained/">ASP.NET/MVC Exception Handling Part1: Framework Exception Handling Explained</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - ObjectCraftworks.com -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>.</span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
